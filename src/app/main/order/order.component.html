<div class="orders-container">
  <header class="orders-header">
    <h1>{{ isProfileMode ? 'Meus Pedidos' : 'Pedidos' }}</h1>
    
    <div class="header-actions">
      <button *ngIf="!isProfileMode" class="btn primary" (click)="newOrder()">
        + Novo Pedido
      </button>
      <button class="btn ghost" (click)="reload()">
        ğŸ”„ Recarregar
      </button>
    </div>
  </header>

  <section class="orders-list" *ngIf="orders.length > 0; else emptyState">
    <table class="orders-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Data</th>
          <th>Total</th>
          <th>Status</th>
          <th>Pagamento</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of orders">
          <td class="order-id">#{{ o.id }}</td>
          <td class="order-client">{{ o.clientName || 'Cliente #' + o.clientId }}</td>
          <td class="order-date">{{ o.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
          <td class="order-total">R$ {{ o.total | number:'1.2-2' }}</td>
          <td class="order-status">
            <span class="status-badge" [class]="getStatusClass(o.status)">
              {{ o.status }}
            </span>
            <span *ngIf="!isProfileMode && getPendingExchangeStatus(o.id)" 
                  class="status-badge status-pending-exchange">
              â³ {{ getPendingExchangeStatus(o.id) }}
            </span>
            <span *ngIf="!isProfileMode && getPendingReturnStatus(o.id)" 
                  class="status-badge status-pending-return">
              â³ {{ getPendingReturnStatus(o.id) }}
            </span>
            <span *ngIf="isProfileMode && getClientExchangeStatus(o.id)" 
                  class="status-badge" 
                  [class]="getClientStatusClass(getClientExchangeStatus(o.id)!)">
              {{ getClientExchangeStatus(o.id) === 'Troca Negada' ? 'âŒ' : '' }}
              {{ getClientExchangeStatus(o.id) === 'Troca Aprovada' ? 'âœ…' : '' }}
              {{ getClientExchangeStatus(o.id) === 'Aguardando Troca' ? 'â³' : '' }}
              {{ getClientExchangeStatus(o.id) }}
            </span>
            <span *ngIf="isProfileMode && getClientReturnStatus(o.id)" 
                  class="status-badge" 
                  [class]="getClientStatusClass(getClientReturnStatus(o.id)!)">
              {{ getClientReturnStatus(o.id) === 'DevoluÃ§Ã£o Negada' ? 'âŒ' : '' }}
              {{ getClientReturnStatus(o.id) === 'DevoluÃ§Ã£o Aprovada' ? 'âœ…' : '' }}
              {{ getClientReturnStatus(o.id) === 'Aguardando DevoluÃ§Ã£o' ? 'â³' : '' }}
              {{ getClientReturnStatus(o.id) }}
            </span>
          </td>
          <td class="order-payment">
            <span class="payment-badge" [class]="getPaymentClass(o.paymentStatus)">
              {{ o.paymentStatus }}
            </span>
          </td>
          <td class="order-actions">
            <div class="actions-group">
              <button class="btn primary btn-sm" (click)="view(o)" title="Visualizar pedido">
                ğŸ‘ï¸ Visualizar
              </button>

              <button *ngIf="o.status === 'PROCESSANDO' && o.paymentStatus === 'PENDENTE'"
                      class="btn primary btn-sm"
                      (click)="markPaid(o)"
                      title="Marcar como pago">
                ğŸ’³ Marcar pago
              </button>
              <button *ngIf="o.status === 'PROCESSANDO'"
                      class="btn ghost btn-sm"
                      (click)="cancel(o)"
                      title="Cancelar pedido">
                âŒ Cancelar
              </button>

              <button *ngIf="o.status === 'APROVADA' && o.paymentStatus === 'APROVADO' && !isProfileMode"
                      class="btn primary btn-sm"
                      (click)="send(o)"
                      title="Enviar pedido">
                ğŸ“¦ Enviar
              </button>
              <button *ngIf="o.status === 'APROVADA'"
                      class="btn ghost btn-sm"
                      (click)="cancel(o)"
                      title="Cancelar pedido">
                âŒ Cancelar
              </button>

              <button *ngIf="o.status === 'TRANSPORTE'"
                      class="btn primary btn-sm"
                      (click)="deliver(o)"
                      title="Confirmar entrega">
                âœ… Confirmar entrega
              </button>

              <button *ngIf="!isProfileMode"
                      class="btn ghost btn-sm btn-danger"
                      (click)="remove(o)"
                      title="Excluir pedido">
                ğŸ—‘ï¸ Excluir
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <ng-template #emptyState>
    <div class="empty-orders">
      <div class="empty-icon">ğŸ“‹</div>
      <h2>{{ isProfileMode ? 'VocÃª ainda nÃ£o possui pedidos' : 'Nenhum pedido cadastrado' }}</h2>
      <p *ngIf="!isProfileMode">Crie um novo pedido para comeÃ§ar.</p>
      <p *ngIf="isProfileMode">Seus pedidos aparecerÃ£o aqui quando vocÃª fizer uma compra.</p>
    </div>
  </ng-template>
</div>
