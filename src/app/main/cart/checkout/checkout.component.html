<div class="checkout-container">
  <h1 class="checkout-title">Finalização do Pedido</h1>

  <div class="checkout-content">
    <form [formGroup]="form" class="checkout-form">
      <section class="form-section">
        <h3 class="section-title">
          <span class="section-icon">1</span>
          Endereço de Entrega
        </h3>
        <div class="grid">
          <div class="field">
            <label for="cep">CEP</label>
            <input 
              id="cep" 
              type="text" 
              formControlName="cep" 
              (blur)="calcFrete()" 
              placeholder="00000-000" 
              maxlength="9" />
          </div>
          <div class="field col-2">
            <label for="endereco">Endereço</label>
            <input id="endereco" type="text" formControlName="endereco" placeholder="Rua, Avenida, etc." />
          </div>
          <div class="field">
            <label for="numero">Número</label>
            <input id="numero" type="text" formControlName="numero" placeholder="Número" />
          </div>
          <div class="field">
            <label for="complemento">Complemento</label>
            <input id="complemento" type="text" formControlName="complemento" placeholder="Apto, Bloco, etc." />
          </div>
        </div>
      </section>

      <section class="form-section">
        <h3 class="section-title">
          <span class="section-icon">2</span>
          Cupom de Desconto
        </h3>
        <div class="coupon-group">
          <div class="field">
            <label for="coupon">Cupom</label>
            <div class="coupon-input-group">
              <input
                id="coupon"
                type="text"
                formControlName="cupom"
                placeholder="Digite o código do cupom"
              />
              <button type="button" class="btn-coupon" (click)="applyCoupon()">Aplicar</button>
            </div>
          </div>
          <div *ngIf="state.cupom" class="coupon-applied">
            <span class="coupon-code">{{ state.cupom }}</span>
            <span class="coupon-discount">- R$ {{ state.desconto | number: '1.2-2' }}</span>
          </div>
        </div>
      </section>

      <section class="form-section">
        <h3 class="section-title">
          <span class="section-icon">3</span>
          Forma de Pagamento
        </h3>

        <div class="field">
          <label>Escolha a forma de pagamento</label>
<div class="payment-select-buttons">
  <button
    type="button"
    [class.active]="form.get('paymentType')?.value === 'ONE'"
    (click)="form.get('paymentType')?.setValue('ONE'); onPaymentTypeChange()">
    1 Cartão
  </button>

  <button
    type="button"
    [class.active]="form.get('paymentType')?.value === 'TWO'"
    (click)="form.get('paymentType')?.setValue('TWO'); onPaymentTypeChange()">
    2 Cartões
  </button>
</div>

        </div>

        <div *ngIf="form.get('paymentType')?.value === 'ONE'" class="field">
          <label for="cardId">Selecione um cartão</label>
          <select id="cardId" formControlName="cardId" (change)="onCardChange()">
            <option [ngValue]="null">Selecione um cartão...</option>
            <option *ngFor="let card of clientCards" [ngValue]="card.numero">
              {{ card.bandeira }} - **** {{ (card.numero + '').slice(-4) }}
            </option>
            <option [ngValue]="'NEW_CARD'">➕ Adicionar novo cartão</option>
          </select>
        </div>

        <div *ngIf="form.get('paymentType')?.value === 'TWO'">
          <div class="field">
            <label for="cardId">Cartão 1</label>
            <select id="cardId" formControlName="cardId">
              <option [ngValue]="null">Selecione cartão 1...</option>
              <option *ngFor="let card of clientCards" [ngValue]="card.numero">
                {{ card.bandeira }} - **** {{ (card.numero + '').slice(-4) }}
              </option>
            </select>
          </div>

          <div class="field">
            <label for="amount1">Valor no Cartão 1</label>
            <input id="amount1" type="number" step="0.01" formControlName="amount1" placeholder="0.00" />
          </div>

          <div class="field">
            <label for="cardId2">Cartão 2</label>
            <select id="cardId2" formControlName="cardId2" (change)="onCardChange()">
              <option [ngValue]="null">Selecione cartão 2...</option>
              <option *ngFor="let card of clientCards" [ngValue]="card.numero">
                {{ card.bandeira }} - **** {{ (card.numero + '').slice(-4) }}
              </option>
              <option [ngValue]="'NEW_CARD'">➕ Adicionar novo cartão</option>
            </select>
          </div>

          <div class="field">
            <label for="amount2">Valor no Cartão 2</label>
            <input id="amount2" type="number" step="0.01" formControlName="amount2" placeholder="0.00" />
          </div>

          <div class="help-text" style="margin-top:8px">O sistema irá conferir se a soma dos dois valores é igual ao total do pedido.</div>
        </div>
      </section>

      <div class="actions">
        <button type="button" class="btn ghost" (click)="cancelar()">Cancelar</button>
        <button type="button" class="btn primary" (click)="confirmar()" [disabled]="form.invalid">
          Finalizar Pedido
        </button>
      </div>
    </form>

    <div class="checkout-summary">
      <h3 class="summary-title">Resumo do Pedido</h3>
      <div class="summary-content">
        <div class="summary-row">
          <span>Subtotal</span>
          <span class="summary-value">R$ {{ state.subtotal || 0 | number: '1.2-2' }}</span>
        </div>
        <div *ngIf="state.desconto && state.desconto > 0" class="summary-row discount">
          <span>Desconto</span>
          <span class="summary-value">- R$ {{ state.desconto | number: '1.2-2' }}</span>
        </div>
        <div *ngIf="state.frete && state.frete > 0" class="summary-row">
          <span>Frete</span>
          <span class="summary-value">R$ {{ state.frete | number: '1.2-2' }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-row total">
          <span><strong>Total</strong></span>
          <span class="summary-value total-value">
            <strong>R$ {{ state.totalComDesconto || state.subtotal | number: '1.2-2' }}</strong>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
